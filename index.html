<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arc Tip Jar • Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet"/>
<style>
body { font-family: 'Inter', sans-serif; background: #0a0a0f; color: #f1f5f9; }
h1, h2 { font-family: 'Space Grotesk', sans-serif; }
#walletStatus.compact { font-size: 0.9rem; padding: 0.5rem 1rem; background: rgba(0,245,255,0.1); border-radius: 1rem; }
</style>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        'neon-cyan': '#00f5ff',
        'dark-bg': '#0a0a0f',
        'dark-card': '#11111a',
        'dark-border': '#1e1e2e',
      },
      boxShadow: {
        'glass': '0 8px 32px rgba(0,0,0,0.37)',
        'neon': '0 0 20px rgba(0,245,255,0.4)',
      }
    }
  }
}
</script>
</head>
<body class="min-h-screen bg-gradient-to-br from-dark-bg to-[#0f172a]">

<div class="container mx-auto px-4 py-10 max-w-6xl">

  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-center mb-12 gap-6">
    <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-neon-cyan to-cyan-400 bg-clip-text text-transparent">Arc Tip Jar</h1>
    <div class="flex items-center gap-6" id="walletArea">
      <button id="connectBtn" onclick="connectWallet()" class="px-6 py-3 bg-gradient-to-r from-neon-cyan to-cyan-600 rounded-2xl font-bold shadow-neon hover:scale-105 transition">Connect Wallet</button>
      <div id="walletStatus" class="text-lg font-medium text-neon-cyan hidden"></div>
    </div>
  </div>

  <!-- Dashboard Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Profile Card -->
    <div class="lg:col-span-1">
      <div class="bg-dark-card backdrop-blur-xl border border-dark-border/50 rounded-3xl p-6 shadow-glass text-center">
        <img id="profileImage" src="https://via.placeholder.com/120" alt="Avatar" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-neon-cyan/40 shadow-neon"/>
        <input id="profileName" placeholder="Creator Name" class="w-full p-3 mb-3 bg-gray-900 border border-dark-border rounded-xl text-white focus:outline-none focus:border-neon-cyan focus:ring-1 focus:ring-neon-cyan"/>
        <input id="profileAvatarFile" type="file" accept="image/*" class="w-full mb-3"/>
        <input id="profileAvatar" placeholder="Or enter avatar URL" class="w-full p-3 mb-3 bg-gray-900 border border-dark-border rounded-xl text-white focus:outline-none focus:border-neon-cyan focus:ring-1 focus:ring-neon-cyan"/>
        <button id="saveProfileBtn" class="w-full py-3 bg-gradient-to-r from-neon-cyan to-cyan-600 rounded-2xl font-bold shadow-neon hover:scale-105 transition">Create / Update Profile</button>
        <h2 id="profileNameDisplay" class="text-2xl font-bold text-neon-cyan mb-1 mt-4">Your Profile</h2>
        <p id="profileBioDisplay" class="text-gray-400 mb-4">Connect wallet to load profile</p>
      </div>
    </div>

    <!-- Earnings Overview -->
    <div class="lg:col-span-2 space-y-6">
      <div class="bg-dark-card backdrop-blur-xl border border-dark-border/50 rounded-3xl p-6 shadow-glass">
        <h3 class="text-xl text-gray-400 mb-1">Total Earned</h3>
        <div class="text-5xl md:text-6xl font-bold text-neon-cyan mb-1">$<span id="totalEarned">0.00</span></div>
        <p class="text-sm text-gray-500">USDC on Arc Network</p>
      </div>

      <div class="bg-dark-card backdrop-blur-xl border border-dark-border/50 rounded-3xl p-6 shadow-glass">
        <h3 class="text-xl text-gray-400 mb-4">Earnings Trend</h3>
        <canvas id="earningsChart" height="120"></canvas>
      </div>
    </div>
  </div>

  <!-- Recent Tips -->
  <div class="mt-10 bg-dark-card backdrop-blur-xl border border-dark-border/50 rounded-3xl p-6 shadow-glass">
    <h3 class="text-2xl font-bold text-neon-cyan mb-4">Recent Tips</h3>
    <div id="recentTips" class="space-y-3 overflow-y-auto max-h-64"></div>
  </div>

  <!-- Tipping Form -->
  <div class="mt-10 bg-dark-card backdrop-blur-xl border border-dark-border/50 rounded-3xl p-6 shadow-glass max-w-3xl mx-auto">
    <h2 class="text-3xl font-bold text-neon-cyan mb-6 text-center">Send a Tip</h2>
    <div class="flex flex-col gap-4 mb-4">
      <select id="creatorSelect" class="w-full p-4 bg-gray-900 border border-dark-border rounded-2xl text-white focus:outline-none focus:border-neon-cyan focus:ring-1 focus:ring-neon-cyan">
        <option value="">Select Creator by Name</option>
      </select>
      <input id="creatorWalletInput" placeholder="Or enter wallet address (0x...)" class="w-full p-4 bg-gray-900 border border-dark-border rounded-2xl text-white focus:outline-none focus:border-neon-cyan focus:ring-1 focus:ring-neon-cyan"/>
    </div>
    <input id="amount" type="number" step="0.01" placeholder="Amount in USDC" class="w-full p-4 mb-4 bg-gray-900 border border-dark-border rounded-2xl text-white focus:outline-none focus:border-neon-cyan focus:ring-1 focus:ring-neon-cyan"/>
    <button id="sendTipBtn" class="w-full py-4 bg-gradient-to-r from-neon-cyan to-cyan-600 rounded-2xl font-bold text-xl shadow-neon hover:scale-105 transition">Send Tip</button>
    <div id="status" class="mt-4 text-center text-yellow-400 font-medium">Idle</div>
  </div>

  <!-- Footer -->
  <footer class="mt-12 text-center text-gray-400 text-sm">
    <p>© 2026 Arc Tip Jar • <a href="https://x.com/RidwanUsIba" class="text-neon-cyan hover:underline">@RidwanUsIba</a></p>
    <p>Contact: info@arctipjar.com</p>
  </footer>

</div>

<script>
const CONTRACT_ADDRESS = "0xa26E5D70180c87b36D98C21155c24709f64569E9";
const USDC_ADDRESS = "0x3600000000000000000000000000000000000000";
const ABI = [
  "function registerAsCreator(string calldata name, string calldata avatarURL) external",
  "function getCreatorStats(address creator) external view returns (string memory name,string memory avatarURL,bool isActive,uint256 lifetimeEarnings,uint256 withdrawable)",
  "event TipSent(address indexed from,address indexed creator,uint256 amount,uint256 fee,string message)"
];

let provider, signer, contract, connectedAccount;
const profileNameInput = document.getElementById("profileName");
const profileAvatarInput = document.getElementById("profileAvatar");
const saveProfileBtn = document.getElementById("saveProfileBtn");
const statusDisplay = document.getElementById("status");
const recentTips = document.getElementById("recentTips");
const creatorSelect = document.getElementById("creatorSelect");

// Chart setup
const ctx = document.getElementById('earningsChart').getContext('2d');
const earningsChart = new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'Earned',data:[],borderColor:'#00f5ff',backgroundColor:'rgba(0,245,255,0.15)',tension:0.4,fill:true}]},
  options:{responsive:true,scales:{y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.08)'},ticks:{color:'#94a3b8'}},x:{grid:{display:false},ticks:{color:'#94a3b8'}}},plugins:{legend:{display:false}}}
});

async function connectWallet(){
  if(!window.ethereum){alert("MetaMask not installed"); return;}
  provider = new ethers.BrowserProvider(window.ethereum);
  [connectedAccount] = await ethereum.request({ method: "eth_requestAccounts" });
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
  // compact display
  const shortAccount = connectedAccount.slice(0,6)+'...'+connectedAccount.slice(-4);
  const walletStatus = document.getElementById("walletStatus");
  walletStatus.innerText = shortAccount;
  walletStatus.classList.add("compact");
  walletStatus.classList.remove("hidden");
  document.getElementById("connectBtn").classList.add("hidden");
  loadProfile();
  loadCreatorsDropdown();
  updateEarnings();
  loadRecentTips();
}

// Save profile on-chain
saveProfileBtn.onclick = async ()=>{
  if(!connectedAccount){alert("Connect wallet first!"); return;}
  const name = profileNameInput.value.trim();
  let avatarURL = profileAvatarInput.value.trim() || "https://via.placeholder.com/120";
  const fileInput = document.getElementById("profileAvatarFile");
  if(fileInput && fileInput.files.length>0){
    avatarURL = URL.createObjectURL(fileInput.files[0]);
  }
  if(!name){alert("Enter a name"); return;}
  try{
    statusDisplay.innerText = "Sending transaction...";
    const tx = await contract.registerAsCreator(name, avatarURL);
    await tx.wait();
    alert("Profile saved on-chain!");
    loadProfile();
    loadCreatorsDropdown();
    statusDisplay.innerText="Profile saved!";
  }catch(e){console.error(e); statusDisplay.innerText="Transaction failed!";}
};

// Load profile
async function loadProfile(){
  if(!contract || !connectedAccount) return;
  try{
    const stats = await contract.getCreatorStats(connectedAccount);
    document.getElementById("profileNameDisplay").innerText = stats.name || "Your Profile";
    document.getElementById("profileImage").src = stats.avatarURL || "https://via.placeholder.com/120";
    document.getElementById("profileBioDisplay").innerText = stats.isActive ? "Active creator" : "Inactive creator";
    document.getElementById("totalEarned").innerText = (Number(stats.withdrawable)/1e6).toFixed(2);
  }catch(e){console.error(e);}
}

// Load creator dropdown
async function loadCreatorsDropdown(){
  // For demo: just add current account
  if(connectedAccount){
    const stats = await contract.getCreatorStats(connectedAccount);
    creatorSelect.innerHTML = `<option value="${connectedAccount}">${stats.name || connectedAccount}</option>`;
  }
}

// Send tip
document.getElementById("sendTipBtn").onclick = async ()=>{
  const selectedCreator = creatorSelect.value;
  const walletInput = document.getElementById("creatorWalletInput").value.trim();
  const amount = document.getElementById("amount").value;
  if(!amount || (!selectedCreator && !walletInput)){alert("Select creator or enter wallet!"); return;}
  const recipient = selectedCreator || walletInput;
  try{
    const tipAmount = ethers.parseUnits(amount,6);
    const tx = await contract.tip(recipient, tipAmount, "Tip from web UI");
    statusDisplay.innerText="Transaction sent...";
    await tx.wait();
    statusDisplay.innerText="Tip successful!";
    loadRecentTips();
    updateEarnings();
  }catch(e){console.error(e); statusDisplay.innerText="Transaction failed!";}
};

// Load recent tips from on-chain events
async function loadRecentTips(){
  if(!contract) return;
  recentTips.innerHTML="";
  const filter = contract.filters.TipSent();
  const events = await contract.queryFilter(filter, -10000); // last ~10k blocks
  const tips = events.reverse().slice(0,10); // latest 10
  const labels = [], data = [];
  tips.forEach(ev=>{
    const tip = ev.args;
    const creatorName = tip.creator.slice(0,6)+'...'; // default short address
    const div = document.createElement("div");
    div.className="flex justify-between items-center p-3 bg-gray-900/40 rounded-2xl border border-dark-border/30";
    div.innerHTML=`<div><span class="text-neon-cyan font-bold">${Number(tip.amount)/1e6} USDC</span> from <span class="text-gray-400 text-sm">${tip.from.slice(0,6)}...</span></div><div class="text-gray-400 text-sm">${tip.message}</div>`;
    recentTips.appendChild(div);
    labels.push(new Date().toLocaleTimeString());
    data.push(Number(tip.amount)/1e6);
  });
  earningsChart.data.labels = labels;
  earningsChart.data.datasets[0].data = data;
  earningsChart.update();
}
</script>
</body>
</html>